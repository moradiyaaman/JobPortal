@model JobFilterViewModel
@{
    ViewData["Title"] = "Jobs";
    var returnUrl = Context.Request.Path + Context.Request.QueryString;
    var jobs = Model.Jobs?.ToList() ?? new List<JobListItemViewModel>();
}

<div class="flex flex-col gap-6">
    <header class="flex flex-col gap-4 border-b border-border-light bg-surface-light/70 px-4 py-6 shadow-sm dark:border-border-dark dark:bg-surface-dark/70 sm:px-6 lg:px-8">
        <div class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
            <div>
                <h1 class="text-2xl font-bold text-content-light dark:text-content-dark">Discover opportunities</h1>
                <p class="text-sm text-subtle-light dark:text-subtle-dark">Search roles, track applications, and save jobs you love.</p>
            </div>
            <div class="flex flex-wrap gap-2">
                <a asp-action="MyApplications" class="btn btn-secondary">My applications</a>
                @if (Model.CanManageSaved)
                {
                    <a asp-action="Saved" class="btn btn-secondary">Saved jobs</a>
                    <a asp-action="Alerts" class="btn btn-secondary">Job alerts</a>
                }
            </div>
        </div>
        <div class="relative">
            <span class="material-symbols-outlined pointer-events-none absolute left-4 top-1/2 -translate-y-1/2 text-subtle-light dark:text-subtle-dark">search</span>
            <input asp-for="Keyword" form="jobs-filter-form" placeholder="Try &quot;Senior engineer remote&quot;" class="w-full rounded-lg border border-border-light bg-background-light py-3 pl-12 pr-10 text-sm text-content-light shadow-sm transition focus:border-primary focus:ring-2 focus:ring-primary/30 dark:border-border-dark dark:bg-background-dark dark:text-content-dark" />
            @if (!string.IsNullOrEmpty(Model.Keyword))
            {
                <a asp-action="Index" class="material-symbols-outlined absolute right-3 top-1/2 -translate-y-1/2 text-subtle-light transition hover:text-primary dark:text-subtle-dark dark:hover:text-primary">close</a>
            }
        </div>
    </header>

    <div class="grid grid-cols-1 gap-8 lg:grid-cols-[320px,1fr]">
        <aside>
            <form id="jobs-filter-form" method="get" class="space-y-6 rounded-lg border border-border-light bg-surface-light p-6 shadow-sm dark:border-border-dark dark:bg-surface-dark">
                <h3 class="text-lg font-bold text-content-light dark:text-content-dark">Filters</h3>
                <div>
                    <label asp-for="Country" class="mb-2 block text-sm font-medium text-subtle-light dark:text-subtle-dark">Location</label>
                    <select asp-for="Country" class="w-full rounded-lg border border-border-light bg-background-light px-3 py-2 text-sm focus:border-primary focus:ring-2 focus:ring-primary/30 dark:border-border-dark dark:bg-background-dark dark:text-content-dark">
                        <option value="">All locations</option>
                        @foreach (var country in Model.AvailableCountries ?? Enumerable.Empty<string>())
                        {
                            <option value="@country">@country</option>
                        }
                    </select>
                </div>
                <div>
                    <label asp-for="JobType" class="mb-2 block text-sm font-medium text-subtle-light dark:text-subtle-dark">Job type</label>
                    <select asp-for="JobType" class="w-full rounded-lg border border-border-light bg-background-light px-3 py-2 text-sm focus:border-primary focus:ring-2 focus:ring-primary/30 dark:border-border-dark dark:bg-background-dark dark:text-content-dark">
                        <option value="">All types</option>
                        @foreach (var jobType in Model.AvailableJobTypes ?? Enumerable.Empty<string>())
                        {
                            <option value="@jobType">@jobType</option>
                        }
                    </select>
                </div>
                <div>
                    <label asp-for="PostedWithinDays" class="mb-2 block text-sm font-medium text-subtle-light dark:text-subtle-dark">Posted within</label>
                    <select asp-for="PostedWithinDays" class="w-full rounded-lg border border-border-light bg-background-light px-3 py-2 text-sm focus:border-primary focus:ring-2 focus:ring-primary/30 dark:border-border-dark dark:bg-background-dark dark:text-content-dark">
                        <option value="">Any time</option>
                        <option value="2">Last 2 days</option>
                        <option value="7">Last 7 days</option>
                        <option value="14">Last 14 days</option>
                        <option value="30">Last 30 days</option>
                    </select>
                </div>
                <button type="submit" class="w-full rounded-lg bg-primary/20 py-2 text-sm font-semibold text-primary transition hover:bg-primary/30">Apply filters</button>
            </form>
        </aside>

        <section class="space-y-6">
            <div class="rounded-lg border border-border-light bg-surface-light shadow-sm dark:border-border-dark dark:bg-surface-dark">
                <nav class="flex space-x-8 border-b border-border-light px-6 dark:border-border-dark">
                    <a class="py-4 text-sm font-semibold text-primary border-b-2 border-primary" href="#">Jobs</a>
                    <span class="py-4 text-sm font-semibold text-subtle-light dark:text-subtle-dark">People</span>
                    <span class="py-4 text-sm font-semibold text-subtle-light dark:text-subtle-dark">Posts</span>
                </nav>
                <div class="p-6">
                    <h2 class="text-lg font-bold text-content-light dark:text-content-dark">@jobs.Count job results</h2>
                    <div class="mt-4 space-y-4">
                        @if (!jobs.Any())
                        {
                            <div class="rounded-lg border border-dashed border-border-light bg-background-light px-6 py-10 text-center text-subtle-light dark:border-border-dark dark:bg-background-dark dark:text-subtle-dark">
                                <h3 class="text-lg font-semibold text-content-light dark:text-content-dark">No jobs found</h3>
                                <p class="mt-2 text-sm">Try broadening your search or adjusting the filters.</p>
                            </div>
                        }
                        else
                        {
                            for (var i = 0; i < jobs.Count; i++)
                            {
                                var job = jobs[i];
                                <article class="flex items-start justify-between gap-4 rounded-lg px-2 py-2 transition hover:bg-background-light dark:hover:bg-background-dark">
                                    <div class="flex-1 space-y-1">
                                        <div class="flex flex-wrap items-center gap-2 text-xs text-subtle-light dark:text-subtle-dark">
                                            <span class="rounded-full bg-primary/10 px-3 py-1 font-semibold text-primary">@job.JobType</span>
                                            <span>Posted @job.PostedAt.ToString("MMM d")</span>
                                        </div>
                                        <p class="text-lg font-semibold text-content-light dark:text-content-dark">
                                            <a asp-action="Details" asp-route-id="@job.Id" class="hover:text-primary">@job.Title</a>
                                        </p>
                                        <p class="text-sm text-subtle-light dark:text-subtle-dark">@job.CompanyName@if(!string.IsNullOrWhiteSpace(job.Location)){<text> Â· @job.Location</text>}</p>
                                        @if (!string.IsNullOrWhiteSpace(job.ProviderSummary))
                                        {
                                            <p class="text-xs text-subtle-light dark:text-subtle-dark">@job.ProviderSummary</p>
                                        }
                                        @if (!string.IsNullOrWhiteSpace(job.Salary))
                                        {
                                            <p class="text-sm font-semibold text-primary">@job.Salary</p>
                                        }
                                        @if (!string.IsNullOrWhiteSpace(job.CompanyWebsite))
                                        {
                                            <p class="text-xs text-subtle-light dark:text-subtle-dark"><a class="hover:text-primary" href="@job.CompanyWebsite" target="_blank" rel="noopener">Visit company site</a></p>
                                        }
                                    </div>
                                    <div class="flex flex-col items-end gap-3">
                                        <a asp-action="Details" asp-route-id="@job.Id" class="btn btn-primary">View role</a>
                                        <div class="flex flex-wrap items-center justify-end gap-2">
                                            @if (job.IsApplied)
                                            {
                                                <span class="rounded-full bg-emerald-100 px-3 py-1 text-xs font-semibold text-emerald-700">Applied</span>
                                            }
                                            @if (Model.CanManageSaved)
                                            {
                                                if (job.IsSaved)
                                                {
                                                    <form asp-action="Unsave" method="post" class="inline-flex">
                                                        @Html.AntiForgeryToken()
                                                        <input type="hidden" name="id" value="@job.Id" />
                                                        <input type="hidden" name="returnUrl" value="@returnUrl" />
                                                        <button type="submit" class="btn btn-secondary">Saved</button>
                                                    </form>
                                                }
                                                else
                                                {
                                                    <form asp-action="Save" method="post" class="inline-flex">
                                                        @Html.AntiForgeryToken()
                                                        <input type="hidden" name="id" value="@job.Id" />
                                                        <input type="hidden" name="returnUrl" value="@returnUrl" />
                                                        <button type="submit" class="btn btn-secondary">Save job</button>
                                                    </form>
                                                }
                                            }
                                        </div>
                                    </div>
                                </article>
                                @if (i < jobs.Count - 1)
                                {
                                    <hr class="border-border-light dark:border-border-dark" />
                                }
                            }
                        }
                    </div>
                </div>
            </div>
        </section>
    </div>
</div>
